"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[509],{464:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t={key:"v-8daa1a0e",path:"/",title:"Introduction",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"What is Redisearch?",slug:"what-is-redisearch",children:[]},{level:2,title:"How it works?",slug:"how-it-works",children:[]},{level:2,title:"Installation",slug:"installation",children:[]},{level:2,title:"Configuration",slug:"configuration",children:[]},{level:2,title:"Entities",slug:"entities",children:[]},{level:2,title:"Filtering",slug:"filtering",children:[]},{level:2,title:"Custom indexes",slug:"custom-indexes",children:[]},{level:2,title:"Custom index definition example",slug:"custom-index-definition-example",children:[]},{level:2,title:"Statistics",slug:"statistics",children:[]},{level:2,title:"Logging",slug:"logging",children:[]}],filePathRelative:"README.md",git:{updatedTime:1692179108e3,contributors:[{name:"Anton",email:"a.shumansky@gmail.com",commits:1},{name:"Krasimir Ivanov",email:"krasimir.ivanov@coretrix.com",commits:1}]}}},167:(n,s,a)=>{a.r(s),a.d(s,{default:()=>I});var t=a(252);const e=(0,t._)("h1",{id:"introduction",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#introduction","aria-hidden":"true"},"#"),(0,t.Uk)(" Introduction")],-1),p=(0,t._)("code",null,"beeorm-redisearch-plugin",-1),o=(0,t.Uk)(" is a plugin for "),c={href:"https://beeorm.io/guide/",target:"_blank",rel:"noopener noreferrer"},u=(0,t.Uk)("BeeORM"),l=(0,t.Uk)(" which enables integration with Redisearch."),i=(0,t.uE)('<h2 id="what-is-redisearch" tabindex="-1"><a class="header-anchor" href="#what-is-redisearch" aria-hidden="true">#</a> What is Redisearch?</h2><p>Redisearch is a source-available Redis module that enables querying, secondary indexing, and full-text search for Redis. These features enable multi-field queries, aggregation, exact phrase matching, numeric filtering, geo filtering and vector similarity semantic search on top of text queries.</p><h2 id="how-it-works" tabindex="-1"><a class="header-anchor" href="#how-it-works" aria-hidden="true">#</a> How it works?</h2><p>Instead of making complex queries to MySQL, you can query the much faster Redisearch, which will return the entity ID and ORM will load the entity from Redis cache by this ID. If the entity is not yet cached in Redis, the ORM will hit MySQL and then cache it.</p><h2 id="installation" tabindex="-1"><a class="header-anchor" href="#installation" aria-hidden="true">#</a> Installation</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>go get -u github.com/coretrix/beeorm-redisearch-plugin\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration" aria-hidden="true">#</a> Configuration</h2>',7),r=(0,t.Uk)("You need to use "),k={href:"https://beeorm.io/guide/",target:"_blank",rel:"noopener noreferrer"},b=(0,t.Uk)("BeeORM"),d=(0,t.Uk)(" in order to use this plugin."),m=(0,t.Uk)("Read how BeeORM plugins work and are set up "),g={href:"https://beeorm.io/plugins/",target:"_blank",rel:"noopener noreferrer"},h=(0,t.Uk)("BeeORM Plugins"),f=(0,t.Uk)("."),q=(0,t._)("li",null,[(0,t._)("p",null,"You can configure the connection with orm yaml file or with Go code, the following example shows configuration with code.")],-1),y=(0,t.uE)('<div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>    beeormRegistry <span class="token operator">:=</span> beeorm<span class="token punctuation">.</span><span class="token function">NewRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// new BeeORM registry</span>\n    \n    beeormRegistry<span class="token punctuation">.</span><span class="token function">RegisterMySQLPool</span><span class="token punctuation">(</span><span class="token string">&quot;root:root@tcp(localhost:13306)/redisearch?multiStatements=true&quot;</span><span class="token punctuation">,</span> beeorm<span class="token punctuation">.</span>MySQLPoolOptions<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">)</span> <span class="token comment">// mysql connection</span>\n    \n    beeormRegistry<span class="token punctuation">.</span><span class="token function">RegisterRedis</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:16379&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">)</span> <span class="token comment">// pool needed for redis cache</span>\n    beeormRegistry<span class="token punctuation">.</span><span class="token function">RegisterRedis</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:16379&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;streams_pool&quot;</span><span class="token punctuation">)</span> <span class="token comment">// pool needed for redis streams, which are used for force reindex and indexing custom indexes</span>\n    beeormRegistry<span class="token punctuation">.</span><span class="token function">RegisterRedis</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:16379&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;search_pool&quot;</span><span class="token punctuation">)</span> <span class="token comment">// pool needed for redisearch itself, its important that it uses db 0!</span>\n    \n    beeormRegistry<span class="token punctuation">.</span><span class="token function">RegisterEntity</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>entity<span class="token punctuation">.</span>TestEntityOne<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// redisearch enabled entities, see entities section</span>\n    beeormRegistry<span class="token punctuation">.</span><span class="token function">RegisterEntity</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>entity<span class="token punctuation">.</span>TestEntityTwo<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n    rsPlugin <span class="token operator">:=</span> redisearch<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token string">&quot;search_pool&quot;</span><span class="token punctuation">)</span> <span class="token comment">// create plugin instance</span>\n    rsPlugin<span class="token punctuation">.</span><span class="token function">RegisterCustomIndex</span><span class="token punctuation">(</span>customindex<span class="token punctuation">.</span><span class="token function">GetEntityOneIndex</span><span class="token punctuation">(</span><span class="token string">&quot;search_pool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// register custom indexes here, see custom indexes section</span>\n    \n    beeormRegistry<span class="token punctuation">.</span><span class="token function">RegisterPlugin</span><span class="token punctuation">(</span>rsPlugin<span class="token punctuation">)</span> <span class="token comment">// register redisearch plugin in BeeORM</span>\n    beeormRegistry<span class="token punctuation">.</span><span class="token function">RegisterPlugin</span><span class="token punctuation">(</span>fake_delete<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// register fake delete plugin in BeeORM (Redisearch plugin supports FakeDelete fields)</span>\n\n    beeormRegistry<span class="token punctuation">.</span><span class="token function">RegisterRedisStream</span><span class="token punctuation">(</span>redisearch<span class="token punctuation">.</span>RedisSearchIndexerChannel<span class="token punctuation">,</span> <span class="token string">&quot;streams_pool&quot;</span><span class="token punctuation">)</span> <span class="token comment">// register the default redis stream that is needed for reindex of the indexes</span>\n    beeormRegistry<span class="token punctuation">.</span><span class="token function">RegisterRedisStreamConsumerGroups</span><span class="token punctuation">(</span>redisearch<span class="token punctuation">.</span>RedisSearchIndexerChannel<span class="token punctuation">,</span> redisearch<span class="token punctuation">.</span>RedisSearchIndexerChannel<span class="token operator">+</span><span class="token string">&quot;_group&quot;</span><span class="token punctuation">)</span>\n\t\n    validatedRegistry<span class="token punctuation">,</span> err <span class="token operator">:=</span> beeormRegistry<span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// validate the BeeORM registry</span>\n    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>\n        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    \n    beeormEngine <span class="token operator">=</span> validatedRegistry<span class="token punctuation">.</span><span class="token function">CreateEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// create BeeORM engine instance</span>\n    \n    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> alter <span class="token operator">:=</span> <span class="token keyword">range</span> beeormEngine<span class="token punctuation">.</span><span class="token function">GetAlters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// execute DB alters</span>\n        alter<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>beeormEngine<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    redisSearch <span class="token operator">:=</span> redisearch<span class="token punctuation">.</span><span class="token function">NewRedisSearch</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> beeormEngine<span class="token punctuation">,</span> <span class="token string">&quot;search_pool&quot;</span><span class="token punctuation">)</span> <span class="token comment">// create redisearch instance, use this instance to access all redisearch methods</span>\n    \n    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> alter <span class="token operator">:=</span> <span class="token keyword">range</span> redisSearch<span class="token punctuation">.</span><span class="token function">GetRedisSearchAlters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// execute redisearch alters</span>\n        alter<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="entities" tabindex="-1"><a class="header-anchor" href="#entities" aria-hidden="true">#</a> Entities</h2><p>In order to enable entities to be used in redisearch, you need to add the following tags:</p><ul><li><code>redisSearch=search_pool</code> in beeorm.ORM field, it must correspond with your redisearch pool name</li><li><code>searchable</code> in each field that you would like to filter by later</li><li><code>sortable</code> in each filed that you would like to be able to sort by later</li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>    <span class="token keyword">type</span> TestEntityOne <span class="token keyword">struct</span> <span class="token punctuation">{</span>\n        beeorm<span class="token punctuation">.</span>ORM    <span class="token string">`orm:&quot;table=test_entity_one;redisCache;redisSearch=search_pool&quot;`</span>\n        ID            <span class="token builtin">uint64</span>           <span class="token string">`orm:&quot;searchable;sortable&quot;`</span>\n        UintPtr       <span class="token operator">*</span><span class="token builtin">uint64</span>          <span class="token string">`orm:&quot;searchable;sortable&quot;`</span>\n        Int           <span class="token builtin">int64</span>            <span class="token string">`orm:&quot;searchable;sortable&quot;`</span>\n        IntPtr        <span class="token operator">*</span><span class="token builtin">int64</span>           <span class="token string">`orm:&quot;searchable;sortable&quot;`</span>\n        Float         <span class="token builtin">float64</span>          <span class="token string">`orm:&quot;searchable;sortable&quot;`</span>\n        FloatPtr      <span class="token operator">*</span><span class="token builtin">float64</span>         <span class="token string">`orm:&quot;searchable;sortable&quot;`</span>\n        String        <span class="token builtin">string</span>           <span class="token string">`orm:&quot;searchable;sortable&quot;`</span>\n        StringPtr     <span class="token operator">*</span><span class="token builtin">string</span>          <span class="token string">`orm:&quot;searchable;sortable&quot;`</span>\n        StringEnum    <span class="token builtin">string</span>           <span class="token string">`orm:&quot;searchable;sortable;enum=entity.TestEntityEnumAll&quot;`</span>\n        StringEnumPtr <span class="token operator">*</span><span class="token builtin">string</span>          <span class="token string">`orm:&quot;searchable;sortable;enum=entity.TestEntityEnumAll&quot;`</span>\n        StringSlice   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>         <span class="token string">`orm:&quot;searchable&quot;`</span>\n        Bool          <span class="token builtin">bool</span>             <span class="token string">`orm:&quot;searchable;sortable&quot;`</span>\n        BoolPtr       <span class="token operator">*</span><span class="token builtin">bool</span>            <span class="token string">`orm:&quot;searchable;sortable&quot;`</span>\n        Time          time<span class="token punctuation">.</span>Time        <span class="token string">`orm:&quot;searchable;sortable;time=true&quot;`</span>\n        TimePtr       <span class="token operator">*</span>time<span class="token punctuation">.</span>Time       <span class="token string">`orm:&quot;searchable;sortable;time=true&quot;`</span>\n        ForeignKey    <span class="token operator">*</span>TestEntityTwo   <span class="token string">`orm:&quot;searchable;sortable&quot;`</span>\n        Many          <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>TestEntityTwo <span class="token string">`orm:&quot;searchable&quot;`</span>\n        FakeDelete    <span class="token builtin">bool</span>             <span class="token string">`orm:&quot;searchable&quot;`</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">type</span> TestEntityTwo <span class="token keyword">struct</span> <span class="token punctuation">{</span>\n        beeorm<span class="token punctuation">.</span>ORM <span class="token string">`orm:&quot;table=test_entity_two;redisCache;redisSearch=search_pool&quot;`</span>\n        ID         <span class="token builtin">uint64</span>\n        Field      <span class="token builtin">string</span> <span class="token string">`orm:&quot;searchable;sortable&quot;`</span>\n    <span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="filtering" tabindex="-1"><a class="header-anchor" href="#filtering" aria-hidden="true">#</a> Filtering</h2><p>I will show a few filtering examples. Please check <code>query.go</code> for all filtering methods.</p><h4 id="redissearchone" tabindex="-1"><a class="header-anchor" href="#redissearchone" aria-hidden="true">#</a> RedisSearchOne</h4><p>You must use <code>RedisSearchOne</code> only when you are sure the filters you provide will result in a unique row.</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>\tq <span class="token operator">:=</span> redisearch<span class="token punctuation">.</span><span class="token function">NewRedisSearchQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\tq<span class="token punctuation">.</span><span class="token function">FilterString</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span>\n    q<span class="token punctuation">.</span><span class="token function">FilterUint</span><span class="token punctuation">(</span><span class="token string">&quot;Age&quot;</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>\n\t\n\tresult <span class="token operator">:=</span> <span class="token operator">&amp;</span>entity<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span>\n\tredisSearch<span class="token punctuation">.</span><span class="token function">RedisSearchOne</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> q<span class="token punctuation">,</span> <span class="token string">&quot;Address&quot;</span><span class="token punctuation">)</span> <span class="token comment">// loads the user inside the entity instance and loads its Address field reference</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="redissearchmany" tabindex="-1"><a class="header-anchor" href="#redissearchmany" aria-hidden="true">#</a> RedisSearchMany</h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>\tq <span class="token operator">:=</span> redisearch<span class="token punctuation">.</span><span class="token function">NewRedisSearchQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\tq<span class="token punctuation">.</span><span class="token function">FilterString</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mark&quot;</span><span class="token punctuation">)</span> <span class="token comment">// you can provide multiple params as var args</span>\n    q<span class="token punctuation">.</span><span class="token function">FilterUint</span><span class="token punctuation">(</span><span class="token string">&quot;Age&quot;</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>\n    q<span class="token punctuation">.</span><span class="token function">FilterDateTimeMinMax</span><span class="token punctuation">(</span>\n        <span class="token string">&quot;CreatedAt&quot;</span><span class="token punctuation">,</span>\n        time<span class="token punctuation">.</span><span class="token function">Date</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>UTC<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        time<span class="token punctuation">.</span><span class="token function">Date</span><span class="token punctuation">(</span><span class="token number">2001</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>UTC<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span>\n\tq<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span><span class="token string">&quot;Age&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// sorts the results by Age desc</span>\n\t\n\tresults <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>entity<span class="token punctuation">.</span>User<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n\tredisSearch<span class="token punctuation">.</span><span class="token function">RedisSearchMany</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> q<span class="token punctuation">,</span>  beeorm<span class="token punctuation">.</span><span class="token function">NewPager</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// loads the users inside the entity slice instance</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="raw-queries" tabindex="-1"><a class="header-anchor" href="#raw-queries" aria-hidden="true">#</a> Raw queries</h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>\tq <span class="token operator">:=</span> redisearch<span class="token punctuation">.</span><span class="token function">NewRedisSearchQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    q<span class="token punctuation">.</span><span class="token function">FilterInt</span><span class="token punctuation">(</span><span class="token string">&quot;Age&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\n    q<span class="token punctuation">.</span><span class="token function">AppendQueryRaw</span><span class="token punctuation">(</span><span class="token string">&quot;@Name: Fran*&quot;</span><span class="token punctuation">)</span> <span class="token comment">// in AppendQueryRaw you can put whatever query you want that satisfies the redisearch query language syntax</span>\n    q<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span><span class="token string">&quot;Int&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>\n    \n    results <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>entity<span class="token punctuation">.</span>TestEntityOne<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n    redisSearch<span class="token punctuation">.</span><span class="token function">RedisSearchMany</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">,</span> q<span class="token punctuation">,</span> beeorm<span class="token punctuation">.</span><span class="token function">NewPager</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="aggregations" tabindex="-1"><a class="header-anchor" href="#aggregations" aria-hidden="true">#</a> Aggregations</h4><p>This plugin supports many aggregations, please see <code>aggregate.go</code> for all aggregation functions. The example below shows the <code>GroupByField</code> aggregation with reducer <code>NewAggregateReduceSum</code>.</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>\tq <span class="token operator">:=</span> redisearch<span class="token punctuation">.</span><span class="token function">NewRedisSearchQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\tq<span class="token punctuation">.</span><span class="token function">FilterUint</span><span class="token punctuation">(</span><span class="token string">&quot;Age&quot;</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span>\n\n\ta <span class="token operator">:=</span> q<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\ta<span class="token punctuation">.</span><span class="token function">GroupByField</span><span class="token punctuation">(</span><span class="token string">&quot;@Age&quot;</span><span class="token punctuation">,</span> redisearch<span class="token punctuation">.</span><span class="token function">NewAggregateReduceSum</span><span class="token punctuation">(</span><span class="token string">&quot;@WalletBalance&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;total_amount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\ta<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span>redisearch<span class="token punctuation">.</span>RedisSearchAggregationSort<span class="token punctuation">{</span>\n\t\tField<span class="token punctuation">:</span> <span class="token string">&quot;@total_amount&quot;</span><span class="token punctuation">,</span>\n\t\tDesc<span class="token punctuation">:</span>  <span class="token boolean">true</span><span class="token punctuation">,</span>\n\t<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n\tresult<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> redisSearch<span class="token punctuation">.</span><span class="token function">RedisSearchAggregate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>entity<span class="token punctuation">.</span>TestEntityOne<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> beeorm<span class="token punctuation">.</span><span class="token function">NewPager</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> row <span class="token operator">:=</span> <span class="token keyword">range</span> result <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token punctuation">{</span>\n            <span class="token keyword">continue</span>\n        <span class="token punctuation">}</span>\n        \n        age<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseUint</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">&quot;Age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>\n        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>\n            <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n        \n        amount<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseFloat</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">&quot;total_amount&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>\n        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>\n            <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="custom-indexes" tabindex="-1"><a class="header-anchor" href="#custom-indexes" aria-hidden="true">#</a> Custom indexes</h2>',18),x=(0,t.Uk)("Sometimes you may need to join MySQL tables in order to execute some complex query. Instead of doing this, you can simply create a custom index, which can contain fields from 1,2,3...100 tables. In order to create custom index, first you must create a CRUD stream on the main entity the index will track. This CRUD stream will be used for indexing. "),w={href:"https://beeorm.io/plugins/crud_stream.html",target:"_blank",rel:"noopener noreferrer"},R=(0,t.Uk)("see BeeORM CRUD streams"),S=(0,t.uE)('<h2 id="custom-index-definition-example" tabindex="-1"><a class="header-anchor" href="#custom-index-definition-example" aria-hidden="true">#</a> Custom index definition example</h2><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>    <span class="token keyword">const</span> UsersAddressesCustomIndex <span class="token operator">=</span> <span class="token string">&quot;custom_index_users_addresses&quot;</span> <span class="token comment">// custom index name</span>\n\n    <span class="token keyword">func</span> <span class="token function">GetUsersAddressesIndex</span><span class="token punctuation">(</span>redisSearchPool <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>redisearch<span class="token punctuation">.</span>RedisSearchIndex <span class="token punctuation">{</span> <span class="token comment">// register this function in the plugin definition</span>\n        index <span class="token operator">:=</span> <span class="token operator">&amp;</span>redisearch<span class="token punctuation">.</span>RedisSearchIndex<span class="token punctuation">{</span><span class="token punctuation">}</span>\n        index<span class="token punctuation">.</span>Name <span class="token operator">=</span> UsersAddressesCustomIndex\n        index<span class="token punctuation">.</span>RedisPool <span class="token operator">=</span> redisSearchPool\n        index<span class="token punctuation">.</span>Prefixes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>UsersAddressesCustomIndex <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">}</span>\n        \n        <span class="token comment">// document fields</span>\n        index<span class="token punctuation">.</span><span class="token function">AddNumericField</span><span class="token punctuation">(</span><span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>\n        index<span class="token punctuation">.</span><span class="token function">AddTextField</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>\n        index<span class="token punctuation">.</span><span class="token function">AddTextField</span><span class="token punctuation">(</span><span class="token string">&quot;AddressLine1&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>\n        \n        <span class="token comment">// force reindex callback func, it will be called by the plugin each time you force reindex</span>\n        index<span class="token punctuation">.</span>Indexer <span class="token operator">=</span> usersAddressesIndexer\n        \n        <span class="token keyword">return</span> index\n    <span class="token punctuation">}</span>\n    \n    <span class="token keyword">func</span> <span class="token function">SetUsersAddressesIndexFields</span><span class="token punctuation">(</span>pusher redisearch<span class="token punctuation">.</span>RedisSearchIndexPusher<span class="token punctuation">,</span> entities <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>entity<span class="token punctuation">.</span>UserEntity<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// call this function in your CRUD stream consumer from UserEntity</span>\n        deletedIDs <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n        \n        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> entityIter <span class="token operator">:=</span> <span class="token keyword">range</span> entities <span class="token punctuation">{</span>\n            id <span class="token operator">:=</span> UsersAddressesCustomIndex <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">FormatUint</span><span class="token punctuation">(</span>entityIter<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>\n            \n            <span class="token keyword">if</span> entityIter<span class="token punctuation">.</span>FakeDelete <span class="token punctuation">{</span>\n                deletedIDs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>deletedIDs<span class="token punctuation">,</span> id<span class="token punctuation">)</span>\n                \n                <span class="token keyword">continue</span>\n            <span class="token punctuation">}</span>\n        \n            pusher<span class="token punctuation">.</span><span class="token function">NewDocument</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>\n            pusher<span class="token punctuation">.</span><span class="token function">SetUint</span><span class="token punctuation">(</span><span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span> entityIter<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>\n            pusher<span class="token punctuation">.</span><span class="token function">SetString</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> entityIter<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>\n            pusher<span class="token punctuation">.</span><span class="token function">SetString</span><span class="token punctuation">(</span><span class="token string">&quot;AddressLine1&quot;</span><span class="token punctuation">,</span> entityIter<span class="token punctuation">.</span>Address<span class="token punctuation">.</span>AddressLine1<span class="token punctuation">)</span> <span class="token comment">// make sure you load the Address reference</span>\n            pusher<span class="token punctuation">.</span><span class="token function">PushDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n        \n        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>deletedIDs<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n            pusher<span class="token punctuation">.</span><span class="token function">DeleteDocuments</span><span class="token punctuation">(</span>deletedIDs<span class="token operator">...</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    \n    <span class="token keyword">func</span> <span class="token function">usersAddressesIndexer</span><span class="token punctuation">(</span>engine beeorm<span class="token punctuation">.</span>Engine<span class="token punctuation">,</span> lastID <span class="token builtin">uint64</span><span class="token punctuation">,</span> pusher redisearch<span class="token punctuation">.</span>RedisSearchIndexPusher<span class="token punctuation">)</span> <span class="token punctuation">(</span>newID <span class="token builtin">uint64</span><span class="token punctuation">,</span> hasMore <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        where <span class="token operator">:=</span> beeorm<span class="token punctuation">.</span><span class="token function">NewWhere</span><span class="token punctuation">(</span><span class="token string">&quot;`ID` &gt; ? AND `FakeDelete` &gt;= 0 ORDER BY `ID` ASC&quot;</span><span class="token punctuation">,</span> lastID<span class="token punctuation">)</span>\n        \n        entities <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>entity<span class="token punctuation">.</span>UserEntity<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n        engine<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span>where<span class="token punctuation">,</span> beeorm<span class="token punctuation">.</span><span class="token function">NewPager</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>entities<span class="token punctuation">,</span> <span class="token string">&quot;Address&quot;</span><span class="token punctuation">)</span> <span class="token comment">// load the Address reference, because we use it in the custom index</span>\n        \n        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>entities<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span> lastID<span class="token punctuation">,</span> <span class="token boolean">false</span>\n        <span class="token punctuation">}</span>\n        \n        <span class="token function">SetUsersAddressesIndexFields</span><span class="token punctuation">(</span>pusher<span class="token punctuation">,</span> entities<span class="token punctuation">)</span>\n        pusher<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        \n        lastID <span class="token operator">=</span> entities<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>entities<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ID\n        \n        <span class="token keyword">return</span> lastID<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>entities<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><p>After you make the custom index definition, you need to register it in the plugin:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>    rsPlugin<span class="token punctuation">.</span><span class="token function">RegisterCustomIndex</span><span class="token punctuation">(</span>customindex<span class="token punctuation">.</span><span class="token function">GetUsersAddressesIndex</span><span class="token punctuation">(</span><span class="token string">&quot;search_pool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="custom-index-query" tabindex="-1"><a class="header-anchor" href="#custom-index-query" aria-hidden="true">#</a> Custom index query</h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>\tq <span class="token operator">:=</span> redisearch<span class="token punctuation">.</span><span class="token function">NewRedisSearchQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\tq<span class="token punctuation">.</span><span class="token function">FilterString</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span>\n\n\tids<span class="token punctuation">,</span> total <span class="token operator">:=</span> redisearch<span class="token punctuation">.</span><span class="token function">GetEntityIDs</span><span class="token punctuation">(</span>redisSearch<span class="token punctuation">,</span> customindex<span class="token punctuation">.</span>EntityOneCustomIndex<span class="token punctuation">,</span> q<span class="token punctuation">,</span> beeorm<span class="token punctuation">.</span><span class="token function">NewPager</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n\tresult <span class="token operator">:=</span> <span class="token operator">&amp;</span>entity<span class="token punctuation">.</span>TestEntityOne<span class="token punctuation">{</span><span class="token punctuation">}</span>\n\tengine<span class="token punctuation">.</span><span class="token function">LoadByID</span><span class="token punctuation">(</span>ids<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="statistics" tabindex="-1"><a class="header-anchor" href="#statistics" aria-hidden="true">#</a> Statistics</h2><p>Use <code>redisSearch.GetRedisSearchStatistics()</code> for many useful stats.</p><h2 id="logging" tabindex="-1"><a class="header-anchor" href="#logging" aria-hidden="true">#</a> Logging</h2><p>Enable logging by <code>ormEngine.EnableQueryDebugCustom(false, true, false)</code>. It will output logs in the following format:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>FT.SEARCH entity.TestEntityOne @String:( &quot;test string 1&quot; )-@FakeDelete:{true} NOCONTENT LIMIT 0 1: [1 2287b:1]\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>',11),v={},I=(0,a(744).Z)(v,[["render",function(n,s){const a=(0,t.up)("OutboundLink");return(0,t.wg)(),(0,t.iD)(t.HY,null,[e,(0,t._)("p",null,[p,o,(0,t._)("a",c,[u,(0,t.Wm)(a)]),l]),i,(0,t._)("ol",null,[(0,t._)("li",null,[(0,t._)("p",null,[r,(0,t._)("a",k,[b,(0,t.Wm)(a)]),d])]),(0,t._)("li",null,[(0,t._)("p",null,[m,(0,t._)("a",g,[h,(0,t.Wm)(a)]),f])]),q]),y,(0,t._)("p",null,[x,(0,t._)("a",w,[R,(0,t.Wm)(a)])]),S],64)}]])},744:(n,s)=>{s.Z=(n,s)=>{for(const[a,t]of s)n[a]=t;return n}}}]);